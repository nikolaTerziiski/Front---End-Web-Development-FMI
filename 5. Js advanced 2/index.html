<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Flutter</title>
	<link rel="stylesheet" href="css/style.css">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
</head>

<body>
	<div class="auth">
		<form class="auth-form" id="login-form" onsubmit="return validation()">
			<h1 class="auth-title">Flutter</h1>
	
			<h2 class="auth-subtitle">Login</h2>
	
			<div class="errors" id="errors"></div>
	
			<input id="loginEmail" type="text" name="email" placeholder="Email" class="auth-input" />
			<input id="loginPassword" type="password" name="password" placeholder="Password" class="auth-input" />
	
			<div class="auth-actions">
				<button type="submit" class="auth-button">Submit</button>
				<a href="register.html" title="Create account" class="auth-link">Create account</a>
			</div>
		</form>
	
		<!--<span class="decoration decoration1"></span>-->
		<!--<span class="decoration decoration2"></span>-->
		<!--<span class="decoration decoration3"></span>-->
		<!--<span class="decoration decoration4"></span>-->
	</div>

	<!-- Loads firbase client API, initializes db facade & loads the controller code -->
	<script src="https://www.gstatic.com/firebasejs/5.5.0/firebase.js"></script>
	<script src="scripts/db-facade.js"></script>

</body>
</html>

<script>
	function validation() {
		let err = document.getElementById("errors");
         err.innerHTML = '';

		var valueOfMail = document.getElementById("loginEmail").value;
        let password = document.getElementById("loginPassword").value;
		let p = document.createElement("p");

        if(valueOfMail.length == 0 || valueOfMail.length < 5){
            p.innerText += "The email is too short";
            document.getElementById("errors").appendChild(p);
            return false;
        }

        let index = valueOfMail.indexOf("@");
        if(index == -1){
            p.innerText += "The email must contain \'@\'";
            document.getElementById("errors").appendChild(p);
            return false;
        }

        if(index == 0){
            p.innerText += "The email cant start with \'@\'";
            document.getElementById("errors").appendChild(p);
            return false;
        }

        let dot = valueOfMail.indexOf(".");
        if(dot == -1){
            p.innerText += "The email must contain \'.\' before domain";
            document.getElementById("errors").appendChild(p);
            return false;
        }

        if(dot < index){
            p.innerText += "Invalid email";
            document.getElementById("errors").appendChild(p);
            return false;
        }

        if(dot == valueOfMail.length-1){
            p.innerText += "Invalid domain";
            document.getElementById("errors").appendChild(p);
            return false;
        }
        if(!(password.match(/[A-Z]/g) && password.match(/[^a-zA-Z/]/g) && password.match(/[0-9]/g) && password.length >= 6))
        {
       	 	p.innerText += "Invalid password";
        	document.getElementById("errors").appendChild(p);
        	return false;
        }
		if(password.indexOf('!') == -1 && password.indexOf('@') == -1 && password.indexOf('$') == -1 && password.indexOf('%') == -1 && password.indexOf('#') == -1 && password.indexOf('^') == -1 && password.indexOf('&') == -1 )
        {
            p.innerText += "Invalid password";
            document.getElementById("errors").appendChild(p);
            return false;
		}
		
		window.login(valueOfMail, password);
		
        return true;
	}
</script>