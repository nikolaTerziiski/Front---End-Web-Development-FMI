<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Flutter - Register</title>
    <link rel="stylesheet" href="css/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
</head>

<body>
    <div class="auth">
        <form class="auth-form" id="register-form" onsubmit="return validation()">
            <h1 class="auth-title">Flutter</h1>

            <h2 class="auth-subtitle">Join the community</h2>

            <div class="errors" id="errors"></div>

            <input id="registerUserName" type="text" name="username" placeholder="User Name" class="auth-input" />
            <input id="registerEmail" type="text" name="email" placeholder="Email" class="auth-input" />
            <input id="registerPassword" type="password" name="password" placeholder="Password" class="auth-input" />

            <div class="auth-actions">
                <button type="submit" class="auth-button">Submit</button>
            </div>
        </form>

        <!--<span class="decoration decoration1"></span>-->
        <!--<span class="decoration decoration2"></span>-->
        <!--<span class="decoration decoration3"></span>-->
        <!--<span class="decoration decoration4"></span>-->
    </div>


<!-- Loads firbase client API, initializes db facade & loads the controller code -->
	<script src="https://www.gstatic.com/firebasejs/5.5.0/firebase.js"></script>
	<script src="scripts/db-facade.js"></script>
</body>

</html>
<script>
    function validation() {
        //reseting the error list
        var err = document.getElementById("errors");
         err.innerHTML = '';

        var username = document.getElementById("registerUserName");
        var email = document.getElementById("registerEmail");
        var password = document.getElementById("registerPassword").value;

        let valueOfMail = email.value;
        let p = document.createElement("p");

        //Making validations for every case and giving back for every case different message
        if(valueOfMail.length == 0 || valueOfMail.length < 5){
            p.innerText += "The email is too short";
            document.getElementById("errors").appendChild(p);
            return false;
        }

        //Taking the index and checking if its in the right place.
        var index = valueOfMail.indexOf("@");
        if(index == -1){
            p.innerText += "The email must contain \'@\'";
            document.getElementById("errors").appendChild(p);
            return false;
        }

        if(index == 0){
            p.innerText += "The email cant start with \'@\'";
            document.getElementById("errors").appendChild(p);
            return false;
        }
        //Taking the dot and checking if exists + if its behind @
        var dot = valueOfMail.indexOf(".");
        if(dot == -1){
            p.innerText += "The email must contain \'.\' before domain";
            document.getElementById("errors").appendChild(p);
            return false;
        }

        if(dot < index){
            p.innerText += "Invalid email";
            document.getElementById("errors").appendChild(p);
            return false;
        }

        if(dot == valueOfMail.length-1){
            p.innerText += "Invalid domain";
            document.getElementById("errors").appendChild(p);
            return false;
        }

        if(password.match(/[A-Z]/g) && password.match(/[^a-zA-Z/]/g) && password.match(/[0-9]/g) && password.length >= 6)
        {
            if(password.indexOf('!') == -1 && password.indexOf('@') == -1 && password.indexOf('$') == -1 && password.indexOf('%') == -1 && password.indexOf('#') == -1 && password.indexOf('^') == -1 && password.indexOf('&') == -1 )
            {
                p.innerText += "Invalid password";
                 document.getElementById("errors").appendChild(p);
                return false;
            }

            window.register(username, email,password);
            alert("registration succesfful!");
            return setTimeout(returnTrue, 2000);
        }
        p.innerText += "Invalid password";
        document.getElementById("errors").appendChild(p);
        return false;
    }
    function returnTrue() {
        return true;
    }
</script>